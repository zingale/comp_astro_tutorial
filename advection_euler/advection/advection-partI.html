
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Linear Advection &#8212; Tutorial on Computational Astrophysics</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/myfile.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Finite-Volumes" href="advection-partII.html" />
    <link rel="prev" title="Linear Advection Equation" href="advection.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/rt_small.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Tutorial on Computational Astrophysics</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Basics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../basics/floating-point/floating-point.html">
   Floating Point and Numerical Error
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../basics/floating-point/numerical_error.html">
     Numerical Errors: Roundoff and Truncation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../basics/diff-int/diff-int.html">
   Differentiation and Integration
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../basics/diff-int/differentiation.html">
     Differentiation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../basics/diff-int/integration.html">
     Integration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../basics/diff-int/exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../basics/roots/root-finding.html">
   Root finding
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../basics/ODEs/ODEs.html">
   Ordinary Differential Equations
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../basics/ODEs/ODEs-partI.html">
     Basic Methods for ODEs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../basics/ODEs/ODEs-partII.html">
     Higher-order Accurate ODE Integration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../basics/ODEs/boundary-value-problems.html">
     Two Point Boundary Value Problems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../basics/ODEs/exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../basics/linear-algebra/la-overview.html">
   Linear Algebra
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../basics/linear-algebra/la-basics.html">
     Linear Algebra
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Advection and Hydrodynamics
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="advection.html">
   Linear Advection Equation
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Linear Advection
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="advection-partII.html">
     Finite-Volumes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="advection-partIII.html">
     Second-order advection
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../burgers/burgers.html">
   Burgers’ Equation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../burgers/burgers-methods.html">
     Burgers’ equation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../burgers/exercises.html">
     Exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../euler/euler.html">
   Euler Equations
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../euler/euler-eigen.html">
     Euler equations eigensystem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../euler/euler-riemann.html">
     Euler Riemann problem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../euler/euler-riemann-sampling.html">
     Sampling the Riemann solution
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../euler/euler-solver.html">
     Second-order Euler solver
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../projects/projects.html">
   Practice Projects
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Elliptic Problems and Multigrid
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../elliptic_multigrid/intro/elliptic-problems.html">
   Poisson problem
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../elliptic_multigrid/relaxation/relaxation.html">
   Relaxation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../elliptic_multigrid/relaxation/elliptic-relaxation.html">
     Relaxation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../elliptic_multigrid/relaxation/elliptic-residual.html">
     Residual
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../elliptic_multigrid/relaxation/elliptic-modes.html">
     Behavior of Single Modes
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../elliptic_multigrid/multigrid/multigrid.html">
   Multigrid
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../elliptic_multigrid/multigrid/multigrid-restrict-prolong.html">
     Restriction and Prolongation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../elliptic_multigrid/multigrid/multigrid-two-grid.html">
     Two Grid Correction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../elliptic_multigrid/multigrid/multigrid-vcycles.html">
     V-Cycles
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Stars
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../stars/stars.html">
   Stars
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../stars/lane-emden.html">
   Lane-Emden polytrope equation
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Integrating Stiff Reaction Networks
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../reaction_networks/reactions.html">
   Nuclear Reactions
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../reaction_networks/stiff-ODEs.html">
   Integrating Stiff ODEs
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../reaction_networks/ODEs-implicit.html">
     Implicit Methods for ODEs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../reaction_networks/ODEs-implicit-systems.html">
     Implicit Methods for Systems of ODEs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../reaction_networks/ODEs-implicit-nonlinear-systems.html">
     Implicit Methods and Nonlinear Systems
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../reaction_networks/integration-example.html">
   Integration Example
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/zingale/comp_astro_tutorial/main?urlpath=tree/content/advection_euler/advection/advection-partI.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/zingale/comp_astro_tutorial/blob/main/content/advection_euler/advection/advection-partI.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/zingale/comp_astro_tutorial"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/zingale/comp_astro_tutorial/issues/new?title=Issue%20on%20page%20%2Fadvection_euler/advection/advection-partI.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/advection_euler/advection/advection-partI.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#representing-data">
   Representing Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-first-attempt">
   A First Attempt
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#test-problem">
   Test problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#grid-class">
   Grid class
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ftcs">
   FTCS
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#stability">
   Stability
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#upwinding">
   Upwinding
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#convergence">
   Convergence
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Linear Advection</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#representing-data">
   Representing Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-first-attempt">
   A First Attempt
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#test-problem">
   Test problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#grid-class">
   Grid class
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ftcs">
   FTCS
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#stability">
   Stability
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#upwinding">
   Upwinding
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#convergence">
   Convergence
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="linear-advection">
<h1>Linear Advection<a class="headerlink" href="#linear-advection" title="Permalink to this headline">#</a></h1>
<p>The equations of hydrodynamics are a system of nonlinear partial differential equations that involve advection of mass, momentum, and energy.  To get a feel for the solution of these equations, we will start with the simple <em>linear advection equation</em>:</p>
<div class="math notranslate nohighlight">
\[a_t + u a_x = 0\]</div>
<p>This requires initial conditions, <span class="math notranslate nohighlight">\(a(x, t=0)\)</span>, and a boundary condition.  The solution to this is easy to write down:</p>
<div class="math notranslate nohighlight">
\[a(x, t) = a(x - ut)\]</div>
<p>any initial profile <span class="math notranslate nohighlight">\(a(\xi)\)</span> is simply advected to the right (for <span class="math notranslate nohighlight">\(u &gt; 0\)</span>) at a velocity <span class="math notranslate nohighlight">\(u\)</span>.</p>
<section id="representing-data">
<h2>Representing Data<a class="headerlink" href="#representing-data" title="Permalink to this headline">#</a></h2>
<p>The process of turning a continuous function, <span class="math notranslate nohighlight">\(a(x)\)</span> into a finite number of values that can be stored
on a computer is called <em>discretization</em>.</p>
<p>We’ll divide our domain into a grid and store the function value at each point in our grid:</p>
<p><img alt="finite-difference grid" src="../../_images/fd_grid_basic.png" /></p>
<p>and we use the notation <span class="math notranslate nohighlight">\(a_i^n = a(x_i,t^n)\)</span> to represent the discrete data in space and time.</p>
</section>
<section id="a-first-attempt">
<h2>A First Attempt<a class="headerlink" href="#a-first-attempt" title="Permalink to this headline">#</a></h2>
<p>We might try to build on what we have already learned:</p>
<ul class="simple">
<li><p>a centered difference for <span class="math notranslate nohighlight">\(a_x\)</span> is second-order accurate, so that should be desirable for discretizing
the spatial terms</p></li>
<li><p>we can do a simple explict Euler method to update the solution in time.</p></li>
</ul>
<p>This would look like:</p>
<div class="math notranslate nohighlight">
\[\frac{a_i^{n+1} - a_i^n}{\Delta t} = -u \frac{a_{i+1}^n - a_{i-1}^n}{2\Delta x}\]</div>
<p>This is an explicit update (the righthand side depends only on the information at the old time—stuff we know).  As this is first order in time and second order in space, this method is called FTCS (for <em>forward-time centered space</em>).</p>
<p>We can rewrite this as:</p>
<div class="math notranslate nohighlight">
\[a_i^{n+1} = a_i^n - \frac{C}{2} (a_{i+1}^n - a_{i-1}^n)\]</div>
<p>where we introduce the Courant number, <span class="math notranslate nohighlight">\(C\)</span>:</p>
<div class="math notranslate nohighlight">
\[C = \frac{u\Delta t}{\Delta x}\]</div>
<p>(this is also called the Courant–Friedrichs–Lewy or CFL number).
<span class="math notranslate nohighlight">\(C\)</span> is dimensionless and is a measure of what fraction of a zone we cross per timestep.</p>
<p>Now imagine that our grid has <code class="docutils literal notranslate"><span class="pre">N</span></code> points, numbered <code class="docutils literal notranslate"><span class="pre">0</span></code>, <code class="docutils literal notranslate"><span class="pre">1</span></code>, … <code class="docutils literal notranslate"><span class="pre">N</span></code>.  When we do the update for <code class="docutils literal notranslate"><span class="pre">a[0]</span></code>, the equation above says we need information from zone <code class="docutils literal notranslate"><span class="pre">a[-1]</span></code>—this is outside our domain.  To accommodate this, and allow us to use the same equation to update all zones, we extend the domain past the boundary, creating <em>ghost points</em>:</p>
<p><img alt="finite-difference ghost points" src="../../_images/fd_ghost.png" /></p>
<p>The ghost points are used to implement boundary conditions.  For instance, if we are periodic, then that means that <span class="math notranslate nohighlight">\(a_0^n = a_{N-1}^n\)</span>, so we would set:</p>
<div class="math notranslate nohighlight">
\[a_N^n = a_1^n\]</div>
<div class="math notranslate nohighlight">
\[a_{-1}^n = a_{N-2}^n\]</div>
</section>
<section id="test-problem">
<h2>Test problem<a class="headerlink" href="#test-problem" title="Permalink to this headline">#</a></h2>
<p>To test our solver, we would like a problem with a known solution at any future point in time.  For advection, this is easy, since the advection equation preserves any initial function and just moves it to the right (for <span class="math notranslate nohighlight">\(u &gt; 0\)</span>) at a velocity <span class="math notranslate nohighlight">\(u\)</span>.  Therefore, we can use periodic boundary conditions on a domain <span class="math notranslate nohighlight">\([0, 1]\)</span> and advect for a time <span class="math notranslate nohighlight">\(1/u\)</span>, one period, and we should get back exactly what we started with.</p>
</section>
<section id="grid-class">
<h2>Grid class<a class="headerlink" href="#grid-class" title="Permalink to this headline">#</a></h2>
<p>To start, let’s make a class that controls our grid and holds our data, and knows how to fill our periodic boundary conditions.  Python arrays begin at <code class="docutils literal notranslate"><span class="pre">0</span></code>, so to make life easier, we will define <code class="docutils literal notranslate"><span class="pre">ilo</span></code> and <code class="docutils literal notranslate"><span class="pre">ihi</span></code> to
point to the first and last point in the domain (not including ghost points).</p>
<p><img alt="lo hi with finite difference grid" src="../../_images/fd_ghost_lohi.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FDGrid</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;a finite-difference grid&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ng</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;create a grid with nx points, ng ghost points (on each end)</span>
<span class="sd">        that runs from [xmin, xmax]&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span> <span class="o">=</span> <span class="n">xmin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span> <span class="o">=</span> <span class="n">xmax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ng</span> <span class="o">=</span> <span class="n">ng</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nx</span> <span class="o">=</span> <span class="n">nx</span>

        <span class="c1"># python is zero-based.  Make easy integers to know where the</span>
        <span class="c1"># real data lives</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ilo</span> <span class="o">=</span> <span class="n">ng</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ihi</span> <span class="o">=</span> <span class="n">ng</span><span class="o">+</span><span class="n">nx</span><span class="o">-</span><span class="mi">1</span>

        <span class="c1"># physical coords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">xmin</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nx</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ng</span><span class="p">)</span><span class="o">-</span><span class="n">ng</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span>

        <span class="c1"># storage for the solution</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nx</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ng</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ainit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nx</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ng</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">scratch_array</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; return a scratch array dimensioned for our grid &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nx</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ng</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fill_BCs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; fill the a single ghostcell with periodic boundary conditions &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ilo</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ihi</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ihi</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ilo</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        
    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ilo</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">ihi</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ainit</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ilo</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">ihi</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;initial conditions&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ilo</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">ihi</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ilo</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">ihi</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">fig</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="ftcs">
<h2>FTCS<a class="headerlink" href="#ftcs" title="Permalink to this headline">#</a></h2>
<p>Now we can write our solver.  It will create the grid object, initialize the data (by calling a function we pass in) and then advance the solution using FTCS.</p>
<p>We will specific the Courant number, <span class="math notranslate nohighlight">\(C\)</span>, and use that to get the timestep, <span class="math notranslate nohighlight">\(\Delta t\)</span>.  As we will see shortly, the Courant number is an important parameter for numerical methods for advection, so making it the primary input makes sense.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ftcs_advection</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">num_periods</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">init_cond</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;solve the linear advection equation using FTCS.  You are required</span>
<span class="sd">    to pass in a function f(g), where g is a FDGrid object that sets up</span>
<span class="sd">    the initial conditions&quot;&quot;&quot;</span>
    
    <span class="n">g</span> <span class="o">=</span> <span class="n">FDGrid</span><span class="p">(</span><span class="n">nx</span><span class="p">)</span>
    
    <span class="c1"># time info</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">C</span><span class="o">*</span><span class="n">g</span><span class="o">.</span><span class="n">dx</span><span class="o">/</span><span class="n">u</span>
    <span class="n">t</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">tmax</span> <span class="o">=</span> <span class="n">num_periods</span><span class="o">*</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">g</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>

    <span class="c1"># initialize the data</span>
    <span class="n">init_cond</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

    <span class="n">g</span><span class="o">.</span><span class="n">ainit</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">a</span><span class="p">[:]</span>
    
    <span class="c1"># evolution loop</span>
    <span class="n">anew</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">scratch_array</span><span class="p">()</span>

    <span class="k">while</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">tmax</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">t</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">&gt;</span> <span class="n">tmax</span><span class="p">:</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">tmax</span> <span class="o">-</span> <span class="n">t</span>
            <span class="n">C</span> <span class="o">=</span> <span class="n">u</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">g</span><span class="o">.</span><span class="n">dx</span>

        <span class="c1"># fill the boundary conditions</span>
        <span class="n">g</span><span class="o">.</span><span class="n">fill_BCs</span><span class="p">()</span>

        <span class="c1"># loop over zones: note since we are periodic and both endpoints</span>
        <span class="c1"># are on the computational domain boundary, we don&#39;t have to</span>
        <span class="c1"># update both g.ilo and g.ihi -- we could set them equal instead.</span>
        <span class="c1"># But this is more general</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">ilo</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">ihi</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">anew</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">C</span><span class="o">*</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">g</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># store the updated solution</span>
        <span class="n">g</span><span class="o">.</span><span class="n">a</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">anew</span><span class="p">[:]</span>
        
        <span class="n">t</span> <span class="o">+=</span> <span class="n">dt</span>

    <span class="k">return</span> <span class="n">g</span>
</pre></div>
</div>
</div>
</div>
<p>Now we need a function to initialize the state.  We’ll do a tophat</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">tophat</span><span class="p">(</span><span class="n">g</span><span class="p">):</span>
    <span class="n">g</span><span class="o">.</span><span class="n">a</span><span class="p">[:]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">g</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.0</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s try this out</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nx</span> <span class="o">=</span> <span class="mi">64</span>
<span class="n">u</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">C</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">ftcs_advection</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">init_cond</span><span class="o">=</span><span class="n">tophat</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/advection-partI_13_0.png" src="../../_images/advection-partI_13_0.png" />
</div>
</div>
<p>That looks really bad!  Remember, if we did well, then the solution after one period should look just like the initial conditions!</p>
<p>We know that our difference approximations should be more accurate for smaller <span class="math notranslate nohighlight">\(\Delta t\)</span> and smaller <span class="math notranslate nohighlight">\(\Delta x\)</span>.  Reducing <span class="math notranslate nohighlight">\(\Delta t\)</span> is equivalent to picking a smaller value of <span class="math notranslate nohighlight">\(C\)</span>.  So let’s try that.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">C</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">ftcs_advection</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">init_cond</span><span class="o">=</span><span class="n">tophat</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/advection-partI_15_0.png" src="../../_images/advection-partI_15_0.png" />
</div>
</div>
<p>That’s still really bad.  Let’s try evolving for less time:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">ftcs_advection</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">init_cond</span><span class="o">=</span><span class="n">tophat</span><span class="p">,</span> <span class="n">num_periods</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/advection-partI_17_0.png" src="../../_images/advection-partI_17_0.png" />
</div>
</div>
<p>That shows that something is happening near the discontinuities.  Maybe we need more resolution?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nx</span> <span class="o">=</span> <span class="mi">256</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">ftcs_advection</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">init_cond</span><span class="o">=</span><span class="n">tophat</span><span class="p">,</span> <span class="n">num_periods</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/advection-partI_19_0.png" src="../../_images/advection-partI_19_0.png" />
</div>
</div>
</section>
<section id="stability">
<h2>Stability<a class="headerlink" href="#stability" title="Permalink to this headline">#</a></h2>
<p>The issue is that the FTCS method is unstable.  There are different ways that we can analyze this.  We’ll do a <em>truncation analysis</em>.</p>
<p>Let’s start with our discrete equation:</p>
<div class="math notranslate nohighlight">
\[a_i^{n+1} = a_i^n - \frac{C}{2} (a_{i+1}^n - a_{i-1}^n)\]</div>
<p>consider the Taylor expansions in space and time:</p>
<div class="math notranslate nohighlight">
\[a_{i\pm 1}^n = a_i^n \pm a_x \Delta x + \frac{1}{2} a_{xx} \Delta x^2 + \mathcal{O}(\Delta x^3)\]</div>
<div class="math notranslate nohighlight">
\[a_i^{n+1} = a_i^n + a_t \Delta t + \frac{1}{2} a_{tt} \Delta t^2 + \mathcal{O}(\Delta t^3)\]</div>
<p>we can replace the <span class="math notranslate nohighlight">\(a_{tt}\)</span> time derivatives in the latter expansion with the analytic equation:</p>
<div class="math notranslate nohighlight">
\[a_t = -u a_x\]</div>
<div class="math notranslate nohighlight">
\[a_{tt} = -u \frac{\partial}{\partial t} \frac{\partial a}{\partial x} = u^2 a_{xx}\]</div>
<p>and we have:</p>
<div class="math notranslate nohighlight">
\[a_i^{n+1} = a_i^n + a_t \Delta t + \frac{1}{2} u^2 a_{xx} \Delta t^2 + \mathcal{O}(\Delta t^3)\]</div>
<p>Now substituting these into our original discrete equation:</p>
<div class="math notranslate nohighlight">
\[a_i^n + a_t \Delta t + \frac{1}{2} u^2 a_{xx} \Delta t^2 + \mathcal{O}(\Delta t^3) = a_i^n - \frac{C}{2} (2 a_x \Delta x) + \mathcal{O}(\Delta x^3)\]</div>
<p>or simplifying:</p>
<div class="math notranslate nohighlight">
\[a_t + u a_x = -\frac{1}{2} u^2 \Delta t a_{xx} + \mathcal{O}(\Delta t^2) + \mathcal{O}(\Delta x^3)\]</div>
<p>The left side looks like our original linear advection equation.  But when we keep some of the terms in our Taylor expansion, we see that our discrete equation more properly represents an advection equation with a term proportional to <span class="math notranslate nohighlight">\(a_{xx}\)</span> on the righthand side.  This looks like a diffusion term.  The action of diffusion is to take a peaked distribution and smear it out over time.  But our diffusion term has a negative coefficient, so it is more like antidiffusion.  This is unphysical.  And there is no value of <span class="math notranslate nohighlight">\(\Delta t\)</span> that makes the diffusion positive, therefore this system is always unstable.</p>
</section>
<section id="upwinding">
<h2>Upwinding<a class="headerlink" href="#upwinding" title="Permalink to this headline">#</a></h2>
<p>Let’s try a different discretization.  We can approximate the space derivative using a one-sided difference as either:</p>
<div class="math notranslate nohighlight">
\[ (a_x)_i \approx \frac{a_i - a_{i-1}}{\Delta x} + \mathcal{O}(\Delta x)\]</div>
<div class="math notranslate nohighlight">
\[ (a_x)_i \approx \frac{a_{i+1} - a_i}{\Delta x} + \mathcal{O}(\Delta x)\]</div>
<p>We’ll choose the one that is an <em>upwinded</em> difference—this means we want to make use of the points from the direction that information is flowing.  In our case, <span class="math notranslate nohighlight">\(u &gt; 0\)</span>, so we want to use the points to the left of <span class="math notranslate nohighlight">\(i\)</span> in approximating our derivative.</p>
<p>Chosing this difference makes us first-order accurate in space and time.  Our difference equation is:</p>
<div class="math notranslate nohighlight">
\[\frac{a_i^{n+1} - a_i^n}{\Delta t} = - u \frac{a_i^n - a_{i-1}^n}{\Delta x}\]</div>
<div class="alert alert-block alert-info">
<p><strong>Exercise:</strong></p>
<p>Implement the first-order upwind method for linear advection and run the top hat initial conditions—how does the solution compare to FTCS?</p>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">upwind_advection</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">num_periods</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">init_cond</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;solve the linear advection equation using FTCS.  You are required</span>
<span class="sd">    to pass in a function f(g), where g is a FDGrid object that sets up</span>
<span class="sd">    the initial conditions&quot;&quot;&quot;</span>
    
    <span class="n">g</span> <span class="o">=</span> <span class="n">FDGrid</span><span class="p">(</span><span class="n">nx</span><span class="p">)</span>
    
    <span class="c1"># time info</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">C</span><span class="o">*</span><span class="n">g</span><span class="o">.</span><span class="n">dx</span><span class="o">/</span><span class="n">u</span>
    <span class="n">t</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">tmax</span> <span class="o">=</span> <span class="n">num_periods</span><span class="o">*</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">g</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span><span class="o">/</span><span class="n">u</span>

    <span class="c1"># initialize the data</span>
    <span class="n">init_cond</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

    <span class="n">g</span><span class="o">.</span><span class="n">ainit</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">a</span><span class="p">[:]</span>
    
    <span class="c1"># evolution loop</span>
    <span class="n">anew</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">scratch_array</span><span class="p">()</span>

    <span class="k">while</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">tmax</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">t</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">&gt;</span> <span class="n">tmax</span><span class="p">:</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">tmax</span> <span class="o">-</span> <span class="n">t</span>
            <span class="n">C</span> <span class="o">=</span> <span class="n">u</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">g</span><span class="o">.</span><span class="n">dx</span>

        <span class="c1"># fill the boundary conditions</span>
        <span class="n">g</span><span class="o">.</span><span class="n">fill_BCs</span><span class="p">()</span>

        <span class="c1"># loop over zones: note since we are periodic and both endpoints</span>
        <span class="c1"># are on the computational domain boundary, we don&#39;t have to</span>
        <span class="c1"># update both g.ilo and g.ihi -- we could set them equal instead.</span>
        <span class="c1"># But this is more general</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">ilo</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">ihi</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">anew</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">C</span><span class="o">*</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">g</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># store the updated solution</span>
        <span class="n">g</span><span class="o">.</span><span class="n">a</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">anew</span><span class="p">[:]</span>
        
        <span class="n">t</span> <span class="o">+=</span> <span class="n">dt</span>
        
    <span class="k">return</span> <span class="n">g</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">C</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">u</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">nx</span> <span class="o">=</span> <span class="mi">128</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">upwind_advection</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">init_cond</span><span class="o">=</span><span class="n">tophat</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/advection-partI_25_0.png" src="../../_images/advection-partI_25_0.png" />
</div>
</div>
</section>
<section id="convergence">
<h2>Convergence<a class="headerlink" href="#convergence" title="Permalink to this headline">#</a></h2>
<p>In order to see whether our methods are working as designed, we need to be able to measure the convergence rate.  With the ODE orbit problem, we had a single point (the current position of Earth) at the end of our integration.  Now we have <span class="math notranslate nohighlight">\(N\)</span> points at the new time.  So we need to define a metric that allows us to quantify the error.</p>
<p>We’ll define a vector norm, the <span class="math notranslate nohighlight">\(L_2\)</span> norm, for a set of discrete data <span class="math notranslate nohighlight">\(\phi_i\)</span>, as:</p>
<div class="math notranslate nohighlight">
\[\|\phi\|_2 = \left ( \Delta x \sum_{i=0}^{N-1} \phi_i^2 \right )^{1/2}\]</div>
<p>and then we can define an error as <span class="math notranslate nohighlight">\(e_i = a_i - a^\mathrm{exact}(x_i)\)</span> for all the points in our domain and compute an error, <span class="math notranslate nohighlight">\(\epsilon\)</span> as <span class="math notranslate nohighlight">\(\| e\|_2\)</span>.  Further, for our problem, after 1 period, we know that the exact solution is just the initial data, so we can write:</p>
<div class="math notranslate nohighlight">
\[\epsilon = \| a_i^\mathrm{final} - a_i^\mathrm{initial} \|_2
   = \left ( \Delta x \sum_{i=0}^{N-1} (a_i^\mathrm{final} - a_i^\mathrm{initial} )^2 \right )^{1/2}\]</div>
<p>One final note: it only makes sense to discuss convergence if the initial conditions themselves converge.  For the top hat, there is a discontinuity, and as we increase and increase the resolution, we will never resolve the step.  So the top hat is not a good set of initial conditions to assess convergence.  We should use a smooth problem.</p>
<div class="alert alert-block alert-info">
<p><strong>Exercise:</strong></p>
<p>Compute the <span class="math notranslate nohighlight">\(L_2\)</span> norm of the error for our upwind method.  In order for it to make sense, we need to use smooth data, so pick the initial conditions as:</p>
<div class="math notranslate nohighlight">
\[a(x, t=0) = 1 + \frac{1}{2} \sin(2\pi x)\]</div>
<p>Now vary the number of grid points and measure the error and estimate the rate at which it converges.</p>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sine</span><span class="p">(</span><span class="n">g</span><span class="p">):</span>
    <span class="n">g</span><span class="o">.</span><span class="n">a</span><span class="p">[:]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">g</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">upwind_advection</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">init_cond</span><span class="o">=</span><span class="n">sine</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/advection-partI_28_0.png" src="../../_images/advection-partI_28_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="n">g</span><span class="p">):</span>
    <span class="n">err</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">ilo</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">ihi</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">err</span> <span class="o">+=</span> <span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">g</span><span class="o">.</span><span class="n">ainit</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
        
    <span class="n">err</span> <span class="o">/=</span> <span class="n">g</span><span class="o">.</span><span class="n">nx</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">u</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">C</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="k">for</span> <span class="n">nx</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">]:</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">upwind_advection</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">init_cond</span><span class="o">=</span><span class="n">sine</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">nx</span><span class="si">:</span><span class="s2">3d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">error</span><span class="p">(</span><span class="n">g</span><span class="p">)</span><span class="si">:</span><span class="s2">7.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 32  0.0950
 64  0.0509
128  0.0263
256  0.0134
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./advection_euler/advection"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="advection.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Linear Advection Equation</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="advection-partII.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Finite-Volumes</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By <a href="https://zingale.github.io">Michael Zingale</a><br/>
  
    <div class="extra_footer">
      <p>
&copy; 2021-2022; CC-BY-NC-SA 4.0
<p>

    </div>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>